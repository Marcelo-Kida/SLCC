--
--Criaçao de Trigger de Log  : A7PROC.TGAR_TIPO_MESG_ATRB
--Tabela associada           : TB_TIPO_MESG_ATRB
--Data Criaçao               : 29-08-2003 12:55:45
--
CREATE OR REPLACE TRIGGER TGAR_TIPO_MESG_ATRB
	AFTER UPDATE OR DELETE OR INSERT
	ON A7.TB_TIPO_MESG_ATRB
	FOR EACH ROW
--
DECLARE
	--
	--Variável de controle de Operaçao (1 = Alter ; 2 = Delete, 3 = Insert)
	nIN_TIPO_OPER  NUMBER := 0;
	--
BEGIN
	--
	IF UPDATING THEN
		nIN_TIPO_OPER := 1;
	ELSIF DELETING THEN
		nIN_TIPO_OPER := 2;
	ELSE
		nIN_TIPO_OPER := 3;
	END IF;
	--
	INSERT	INTO A7.TB_LOG_TIPO_MESG_ATRB
			(TP_MESG,
			TP_FORM_MESG,
			NO_ATRB_MESG,
			TP_FORM_MESG_SAID,
			NU_ORDE_AGRU_ATRB,
			IN_ATRB_IDEF_MESG,
			IN_OBRI_ATRB,
			NU_NIVE_MESG_ATRB,
			QT_REPE,
			IN_TIPO_OPER,
			CO_USUA_OPER,
			CO_ETCA_TRAB_OPER,
			DH_OPER)
	VALUES	(:OLD.TP_MESG,
			:OLD.TP_FORM_MESG,
			:OLD.NO_ATRB_MESG,
			:OLD.TP_FORM_MESG_SAID,
			:OLD.NU_ORDE_AGRU_ATRB,
			:OLD.IN_ATRB_IDEF_MESG,
			:OLD.IN_OBRI_ATRB,
			:OLD.NU_NIVE_MESG_ATRB,
			:OLD.QT_REPE,
			nIN_TIPO_OPER,
			NULL,
			NULL,
			SYSDATE);
	--
	EXCEPTION
		WHEN OTHERS THEN
		RAISE_APPLICATION_ERROR(-20001,'Erro na execuçao da Trigger TGAR_TIPO_MESG_ATRB'
								||'A7.TB_LOG_TIPO_MESG_ATRB'
								|| SQLCODE || ' - '
								|| SUBSTR(SQLERRM, 1, 100));
	--
END;
/
